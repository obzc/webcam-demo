<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>Web Kamera Örneği</title>
	<script type="text/javascript" src="https://unpkg.com/webcam-easy/dist/webcam-easy.min.js"></script>
	<script type="text/javascript" src="crop.js"></script>

	<style>
		body {
			padding: 0;
			margin: 0;
		}

		.camera-feed,
		.photo {
			width: 70vw;
			height: auto;
		}

		.show-photo .take-photo {
			display: none;
		}

		.show-photo .camera-feed {
			display: none;
		}

		.show-camera .open-camera {
			display: none;
		}

		.show-camera .photo {
			display: none;
		}

		body:not(.show-camera) .take-photo {
			display: none;
		}

		body:not(.show-camera) .flip-camera {
			display: none;
		}

		.camera-wrapper {
			position: relative;
			width: 70vw;
		}

		.show-camera .camera-wrapper::after {
			content: "";
			position: absolute;
			width: 66vw;
			height: calc(76vw / 1.75);
			left: 2vw;
			right: 2vw;
			top: 2vw;
			bottom: 2vw;
			z-index: 2;
			box-shadow: inset 0 0 0 2vw rgb(0 0 0 / 61%);
		}
	</style>
</head>

<body>
	<div>
		<button onclick="OpenCamera()" class="open-camera">Kamerayı Aç</button>
		<button onclick="TakePhoto()" class="take-photo">Fotoğraf Çek</button>
		<button onclick="FlipCamera()" class="flip-camera">Kamera Değiştir</button>
	</div>

	<div class="camera-wrapper">
		<video id="webcam" autoplay playsinline class="camera-feed"></video>
	</div>

	<canvas id="canvas" class="photo"></canvas>
	<hr>
	<img id="cropped" src="" alt="">
</body>

<script>
	const webcamElement = document.getElementById('webcam');
	const canvasElement = document.getElementById('canvas');
	const snapSoundElement = document.getElementById('snapSound');
	const webcam = new Webcam(webcamElement, 'environment', canvasElement, snapSoundElement);

	function OpenCamera() {
		webcam.start();

		document.body.classList.remove("show-photo");
		document.body.classList.add("show-camera");
	}

	function FlipCamera() {
		webcam.flip();
		webcam.start();
	}

	function TakePhoto() {
		const picture = webcam.snap();
		console.log("Crop Clicked");
		croppedImageString = document.getElementById('croppedImageTextBox');

		getImageDimensions(picture).then(offsets => {
			var width = offsets.w;
			var height = offsets.w / 1.75;
			let xstart = (2 * document.documentElement.clientWidth / 100) + (2 * document.documentElement.clientWidth / 100);
			let ystart = 10;
			cropImage(picture, width, height, xstart, ystart, (imgUri) => {

				document.getElementById('cropped').src = imgUri;
			});

		})


		webcam.stop();

		document.body.classList.add("show-photo");
		document.body.classList.remove("show-camera");
	}

	function getImageDimensions(file) {
		return new Promise(function (resolved, rejected) {
			var i = new Image()
			i.onload = function () {
				resolved({ w: i.width, h: i.height })
			};
			i.src = file
		})
	}
</script>

</html>